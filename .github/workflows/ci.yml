name: CI Pipeline

   on:
     push:
       branches: [ main ]
     pull_request:
       branches: [ main ]

   jobs:
     test:
       runs-on: ubuntu-latest

       steps:
       - name: Checkout code
         uses: actions/checkout@v4

       - name: Set up Node.js
         uses: actions/setup-node@v4
         with:
           node-version: '20'

       - name: Install dependencies
         run: npm install

       - name: Install Playwright browsers
         run: npx playwright install --with-deps

       - name: Run Cucumber tests
         run: npm test
         env:
           TRELLO_EMAIL: ${{ secrets.TRELLO_EMAIL }}
           TRELLO_PASSWORD: ${{ secrets.TRELLO_PASSWORD }}
           TRELLO_WRONG_PASSWORD: ${{ secrets.TRELLO_WRONG_PASSWORD }}

       - name: Upload test results
         if: always()
         uses: actions/upload-artifact@v4
         with:
           name: test-results
           path: |
             *.xml
             *.json